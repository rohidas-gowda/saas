{"ast":null,"code":"function resizeImage(file, MAX_WIDTH, MAX_HEIGHT) {\n  const image = document.createElement('img');\n\n  const resize = resolve => () => {\n    let isResizeNeeded = false;\n    let width = image.width;\n    let height = image.height;\n\n    if (width > height) {\n      if (width > MAX_WIDTH) {\n        isResizeNeeded = true;\n        height *= MAX_WIDTH / width;\n        width = MAX_WIDTH;\n      }\n    } else {\n      if (height > MAX_HEIGHT) {\n        isResizeNeeded = true;\n        width *= MAX_HEIGHT / height;\n        height = MAX_HEIGHT;\n      }\n    }\n\n    if (isResizeNeeded) {\n      const canvas = document.createElement('canvas');\n      canvas.width = width;\n      canvas.height = height;\n      console.log(width, height);\n      const ctx = canvas.getContext('2d');\n      ctx.drawImage(image, 0, 0, width, height);\n      canvas.toBlob(blob => {\n        resolve(blob);\n      }, file.type);\n    } else {\n      resolve(file);\n    }\n  };\n\n  return new Promise(resolve => {\n    const reader = new FileReader();\n    reader.readAsDataURL(file);\n\n    reader.onload = e => {\n      image.src = e.target.result.toString();\n      image.onload = resize(resolve);\n    };\n  });\n}\n\nexport { resizeImage };","map":{"version":3,"names":["resizeImage","file","MAX_WIDTH","MAX_HEIGHT","image","document","createElement","resize","resolve","isResizeNeeded","width","height","canvas","console","log","ctx","getContext","drawImage","toBlob","blob","type","Promise","reader","FileReader","readAsDataURL","onload","e","src","target","result","toString"],"sources":["E:/saas/book/1-begin/app/lib/resizeImage.ts"],"sourcesContent":["function resizeImage(file: File, MAX_WIDTH, MAX_HEIGHT) {\r\n  const image = document.createElement('img');\r\n\r\n  const resize = (resolve) => () => {\r\n    let isResizeNeeded = false;\r\n    let width = image.width;\r\n    let height = image.height;\r\n\r\n    if (width > height) {\r\n      if (width > MAX_WIDTH) {\r\n        isResizeNeeded = true;\r\n        height *= MAX_WIDTH / width;\r\n        width = MAX_WIDTH;\r\n      }\r\n    } else {\r\n      if (height > MAX_HEIGHT) {\r\n        isResizeNeeded = true;\r\n        width *= MAX_HEIGHT / height;\r\n        height = MAX_HEIGHT;\r\n      }\r\n    }\r\n\r\n    if (isResizeNeeded) {\r\n      const canvas = document.createElement('canvas');\r\n\r\n      canvas.width = width;\r\n      canvas.height = height;\r\n\r\n      console.log(width, height);\r\n\r\n      const ctx = canvas.getContext('2d');\r\n      ctx.drawImage(image, 0, 0, width, height);\r\n\r\n      canvas.toBlob((blob) => {\r\n        resolve(blob);\r\n      }, file.type);\r\n    } else {\r\n      resolve(file);\r\n    }\r\n  };\r\n\r\n  return new Promise((resolve) => {\r\n    const reader = new FileReader();\r\n\r\n    reader.readAsDataURL(file);\r\n\r\n    reader.onload = (e) => {\r\n      image.src = e.target.result.toString();\r\n\r\n      image.onload = resize(resolve);\r\n    };\r\n  });\r\n}\r\n\r\nexport { resizeImage };\r\n"],"mappings":"AAAA,SAASA,WAAT,CAAqBC,IAArB,EAAiCC,SAAjC,EAA4CC,UAA5C,EAAwD;EACtD,MAAMC,KAAK,GAAGC,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAd;;EAEA,MAAMC,MAAM,GAAIC,OAAD,IAAa,MAAM;IAChC,IAAIC,cAAc,GAAG,KAArB;IACA,IAAIC,KAAK,GAAGN,KAAK,CAACM,KAAlB;IACA,IAAIC,MAAM,GAAGP,KAAK,CAACO,MAAnB;;IAEA,IAAID,KAAK,GAAGC,MAAZ,EAAoB;MAClB,IAAID,KAAK,GAAGR,SAAZ,EAAuB;QACrBO,cAAc,GAAG,IAAjB;QACAE,MAAM,IAAIT,SAAS,GAAGQ,KAAtB;QACAA,KAAK,GAAGR,SAAR;MACD;IACF,CAND,MAMO;MACL,IAAIS,MAAM,GAAGR,UAAb,EAAyB;QACvBM,cAAc,GAAG,IAAjB;QACAC,KAAK,IAAIP,UAAU,GAAGQ,MAAtB;QACAA,MAAM,GAAGR,UAAT;MACD;IACF;;IAED,IAAIM,cAAJ,EAAoB;MAClB,MAAMG,MAAM,GAAGP,QAAQ,CAACC,aAAT,CAAuB,QAAvB,CAAf;MAEAM,MAAM,CAACF,KAAP,GAAeA,KAAf;MACAE,MAAM,CAACD,MAAP,GAAgBA,MAAhB;MAEAE,OAAO,CAACC,GAAR,CAAYJ,KAAZ,EAAmBC,MAAnB;MAEA,MAAMI,GAAG,GAAGH,MAAM,CAACI,UAAP,CAAkB,IAAlB,CAAZ;MACAD,GAAG,CAACE,SAAJ,CAAcb,KAAd,EAAqB,CAArB,EAAwB,CAAxB,EAA2BM,KAA3B,EAAkCC,MAAlC;MAEAC,MAAM,CAACM,MAAP,CAAeC,IAAD,IAAU;QACtBX,OAAO,CAACW,IAAD,CAAP;MACD,CAFD,EAEGlB,IAAI,CAACmB,IAFR;IAGD,CAdD,MAcO;MACLZ,OAAO,CAACP,IAAD,CAAP;IACD;EACF,CApCD;;EAsCA,OAAO,IAAIoB,OAAJ,CAAab,OAAD,IAAa;IAC9B,MAAMc,MAAM,GAAG,IAAIC,UAAJ,EAAf;IAEAD,MAAM,CAACE,aAAP,CAAqBvB,IAArB;;IAEAqB,MAAM,CAACG,MAAP,GAAiBC,CAAD,IAAO;MACrBtB,KAAK,CAACuB,GAAN,GAAYD,CAAC,CAACE,MAAF,CAASC,MAAT,CAAgBC,QAAhB,EAAZ;MAEA1B,KAAK,CAACqB,MAAN,GAAelB,MAAM,CAACC,OAAD,CAArB;IACD,CAJD;EAKD,CAVM,CAAP;AAWD;;AAED,SAASR,WAAT"},"metadata":{},"sourceType":"module"}