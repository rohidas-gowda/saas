{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport 'isomorphic-unfetch';\nexport default function sendRequestAndGetResponse(_x) {\n  return _sendRequestAndGetResponse.apply(this, arguments);\n}\n\nfunction _sendRequestAndGetResponse() {\n  _sendRequestAndGetResponse = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(path) {\n    var opts,\n        headers,\n        request,\n        qs,\n        response,\n        text,\n        data,\n        _args = arguments;\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            opts = _args.length > 1 && _args[1] !== undefined ? _args[1] : {};\n            headers = Object.assign({}, opts.headers || {}, opts.externalServer ? {} : {\n              'Content-type': 'application/json; charset=UTF-8'\n            });\n            request = opts.request;\n\n            if (request && request.headers && request.headers.cookie) {\n              headers.cookie = request.headers.cookie;\n            }\n\n            qs = opts.qs || '';\n            _context.next = 7;\n            return fetch(opts.externalServer ? \"\".concat(path).concat(qs) : \"\".concat(process.env.URL_API).concat(path).concat(qs), Object.assign({\n              method: 'POST',\n              credentials: 'include'\n            }, opts, {\n              headers: headers\n            }));\n\n          case 7:\n            response = _context.sent;\n            _context.next = 10;\n            return response.text();\n\n          case 10:\n            text = _context.sent;\n\n            if (!(response.status >= 400)) {\n              _context.next = 14;\n              break;\n            }\n\n            console.error(text);\n            throw new Error(response.status.toString());\n\n          case 14:\n            _context.prev = 14;\n            data = JSON.parse(text);\n            return _context.abrupt(\"return\", data);\n\n          case 19:\n            _context.prev = 19;\n            _context.t0 = _context[\"catch\"](14);\n\n            if (!(_context.t0 instanceof SyntaxError)) {\n              _context.next = 23;\n              break;\n            }\n\n            return _context.abrupt(\"return\", text);\n\n          case 23:\n            throw _context.t0;\n\n          case 24:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee, null, [[14, 19]]);\n  }));\n  return _sendRequestAndGetResponse.apply(this, arguments);\n}","map":{"version":3,"names":["sendRequestAndGetResponse","path","opts","headers","Object","assign","externalServer","request","cookie","qs","fetch","process","env","URL_API","method","credentials","response","text","status","console","error","Error","toString","data","JSON","parse","SyntaxError"],"sources":["E:/saas/book/1-begin/app/lib/api/sendRequestAndGetResponse.ts"],"sourcesContent":["import 'isomorphic-unfetch';\r\n\r\nexport default async function sendRequestAndGetResponse(path, opts: any = {}) {\r\n  const headers = Object.assign(\r\n    {},\r\n    opts.headers || {},\r\n    opts.externalServer\r\n      ? {}\r\n      : {\r\n          'Content-type': 'application/json; charset=UTF-8',\r\n        },\r\n  );\r\n\r\n  const { request } = opts;\r\n  if (request && request.headers && request.headers.cookie) {\r\n    headers.cookie = request.headers.cookie;\r\n  }\r\n\r\n  const qs = opts.qs || '';\r\n\r\n  const response = await fetch(\r\n    opts.externalServer ? `${path}${qs}` : `${process.env.URL_API}${path}${qs}`,\r\n    Object.assign({ method: 'POST', credentials: 'include' }, opts, { headers }),\r\n  );\r\n\r\n  //console.log(response.status);\r\n  // console.log(response.statusText);\r\n\r\n  const text = await response.text();\r\n\r\n  if (response.status >= 400) {\r\n    console.error(text);\r\n    throw new Error(response.status.toString());\r\n  }\r\n\r\n  try {\r\n    const data = JSON.parse(text);\r\n\r\n    return data;\r\n  } catch (err) {\r\n    if (err instanceof SyntaxError) {\r\n      return text;\r\n    }\r\n\r\n    throw err;\r\n  }\r\n}\r\n"],"mappings":";;AAAA,OAAO,oBAAP;AAEA,wBAA8BA,yBAA9B;EAAA;AAAA;;;wFAAe,iBAAyCC,IAAzC;IAAA;IAAA;IAAA;IAAA;IAAA;IAAA;IAAA;IAAA;IAAA;MAAA;QAAA;UAAA;YAA+CC,IAA/C,2DAA2D,EAA3D;YACPC,OADO,GACGC,MAAM,CAACC,MAAP,CACd,EADc,EAEdH,IAAI,CAACC,OAAL,IAAgB,EAFF,EAGdD,IAAI,CAACI,cAAL,GACI,EADJ,GAEI;cACE,gBAAgB;YADlB,CALU,CADH;YAWLC,OAXK,GAWOL,IAXP,CAWLK,OAXK;;YAYb,IAAIA,OAAO,IAAIA,OAAO,CAACJ,OAAnB,IAA8BI,OAAO,CAACJ,OAAR,CAAgBK,MAAlD,EAA0D;cACxDL,OAAO,CAACK,MAAR,GAAiBD,OAAO,CAACJ,OAAR,CAAgBK,MAAjC;YACD;;YAEKC,EAhBO,GAgBFP,IAAI,CAACO,EAAL,IAAW,EAhBT;YAAA;YAAA,OAkBUC,KAAK,CAC1BR,IAAI,CAACI,cAAL,aAAyBL,IAAzB,SAAgCQ,EAAhC,cAA0CE,OAAO,CAACC,GAAR,CAAYC,OAAtD,SAAgEZ,IAAhE,SAAuEQ,EAAvE,CAD0B,EAE1BL,MAAM,CAACC,MAAP,CAAc;cAAES,MAAM,EAAE,MAAV;cAAkBC,WAAW,EAAE;YAA/B,CAAd,EAA0Db,IAA1D,EAAgE;cAAEC,OAAO,EAAPA;YAAF,CAAhE,CAF0B,CAlBf;;UAAA;YAkBPa,QAlBO;YAAA;YAAA,OA0BMA,QAAQ,CAACC,IAAT,EA1BN;;UAAA;YA0BPA,IA1BO;;YAAA,MA4BTD,QAAQ,CAACE,MAAT,IAAmB,GA5BV;cAAA;cAAA;YAAA;;YA6BXC,OAAO,CAACC,KAAR,CAAcH,IAAd;YA7BW,MA8BL,IAAII,KAAJ,CAAUL,QAAQ,CAACE,MAAT,CAAgBI,QAAhB,EAAV,CA9BK;;UAAA;YAAA;YAkCLC,IAlCK,GAkCEC,IAAI,CAACC,KAAL,CAAWR,IAAX,CAlCF;YAAA,iCAoCJM,IApCI;;UAAA;YAAA;YAAA;;YAAA,MAsCP,uBAAeG,WAtCR;cAAA;cAAA;YAAA;;YAAA,iCAuCFT,IAvCE;;UAAA;YAAA;;UAAA;UAAA;YAAA;QAAA;MAAA;IAAA;EAAA,C"},"metadata":{},"sourceType":"module"}