{"ast":null,"code":"function resizeImage(file, MAX_WIDTH, MAX_HEIGHT) {\n  var image = document.createElement('img');\n\n  var resize = function resize(resolve) {\n    return function () {\n      var isResizeNeeded = false;\n      var width = image.width;\n      var height = image.height;\n\n      if (width > height) {\n        if (width > MAX_WIDTH) {\n          isResizeNeeded = true;\n          height *= MAX_WIDTH / width;\n          width = MAX_WIDTH;\n        }\n      } else {\n        if (height > MAX_HEIGHT) {\n          isResizeNeeded = true;\n          width *= MAX_HEIGHT / height;\n          height = MAX_HEIGHT;\n        }\n      }\n\n      if (isResizeNeeded) {\n        var canvas = document.createElement('canvas');\n        canvas.width = width;\n        canvas.height = height;\n        console.log(width, height);\n        var ctx = canvas.getContext('2d');\n        ctx.drawImage(image, 0, 0, width, height);\n        canvas.toBlob(function (blob) {\n          resolve(blob);\n        }, file.type);\n      } else {\n        resolve(file);\n      }\n    };\n  };\n\n  return new Promise(function (resolve) {\n    var reader = new FileReader();\n    reader.readAsDataURL(file);\n\n    reader.onload = function (e) {\n      image.src = e.target.result.toString();\n      image.onload = resize(resolve);\n    };\n  });\n}\n\nexport { resizeImage };","map":{"version":3,"names":["resizeImage","file","MAX_WIDTH","MAX_HEIGHT","image","document","createElement","resize","resolve","isResizeNeeded","width","height","canvas","console","log","ctx","getContext","drawImage","toBlob","blob","type","Promise","reader","FileReader","readAsDataURL","onload","e","src","target","result","toString"],"sources":["E:/saas/book/1-begin/app/lib/resizeImage.ts"],"sourcesContent":["function resizeImage(file: File, MAX_WIDTH, MAX_HEIGHT) {\r\n  const image = document.createElement('img');\r\n\r\n  const resize = (resolve) => () => {\r\n    let isResizeNeeded = false;\r\n    let width = image.width;\r\n    let height = image.height;\r\n\r\n    if (width > height) {\r\n      if (width > MAX_WIDTH) {\r\n        isResizeNeeded = true;\r\n        height *= MAX_WIDTH / width;\r\n        width = MAX_WIDTH;\r\n      }\r\n    } else {\r\n      if (height > MAX_HEIGHT) {\r\n        isResizeNeeded = true;\r\n        width *= MAX_HEIGHT / height;\r\n        height = MAX_HEIGHT;\r\n      }\r\n    }\r\n\r\n    if (isResizeNeeded) {\r\n      const canvas = document.createElement('canvas');\r\n\r\n      canvas.width = width;\r\n      canvas.height = height;\r\n\r\n      console.log(width, height);\r\n\r\n      const ctx = canvas.getContext('2d');\r\n      ctx.drawImage(image, 0, 0, width, height);\r\n\r\n      canvas.toBlob((blob) => {\r\n        resolve(blob);\r\n      }, file.type);\r\n    } else {\r\n      resolve(file);\r\n    }\r\n  };\r\n\r\n  return new Promise((resolve) => {\r\n    const reader = new FileReader();\r\n\r\n    reader.readAsDataURL(file);\r\n\r\n    reader.onload = (e) => {\r\n      image.src = e.target.result.toString();\r\n\r\n      image.onload = resize(resolve);\r\n    };\r\n  });\r\n}\r\n\r\nexport { resizeImage };\r\n"],"mappings":"AAAA,SAASA,WAAT,CAAqBC,IAArB,EAAiCC,SAAjC,EAA4CC,UAA5C,EAAwD;EACtD,IAAMC,KAAK,GAAGC,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAd;;EAEA,IAAMC,MAAM,GAAG,SAATA,MAAS,CAACC,OAAD;IAAA,OAAa,YAAM;MAChC,IAAIC,cAAc,GAAG,KAArB;MACA,IAAIC,KAAK,GAAGN,KAAK,CAACM,KAAlB;MACA,IAAIC,MAAM,GAAGP,KAAK,CAACO,MAAnB;;MAEA,IAAID,KAAK,GAAGC,MAAZ,EAAoB;QAClB,IAAID,KAAK,GAAGR,SAAZ,EAAuB;UACrBO,cAAc,GAAG,IAAjB;UACAE,MAAM,IAAIT,SAAS,GAAGQ,KAAtB;UACAA,KAAK,GAAGR,SAAR;QACD;MACF,CAND,MAMO;QACL,IAAIS,MAAM,GAAGR,UAAb,EAAyB;UACvBM,cAAc,GAAG,IAAjB;UACAC,KAAK,IAAIP,UAAU,GAAGQ,MAAtB;UACAA,MAAM,GAAGR,UAAT;QACD;MACF;;MAED,IAAIM,cAAJ,EAAoB;QAClB,IAAMG,MAAM,GAAGP,QAAQ,CAACC,aAAT,CAAuB,QAAvB,CAAf;QAEAM,MAAM,CAACF,KAAP,GAAeA,KAAf;QACAE,MAAM,CAACD,MAAP,GAAgBA,MAAhB;QAEAE,OAAO,CAACC,GAAR,CAAYJ,KAAZ,EAAmBC,MAAnB;QAEA,IAAMI,GAAG,GAAGH,MAAM,CAACI,UAAP,CAAkB,IAAlB,CAAZ;QACAD,GAAG,CAACE,SAAJ,CAAcb,KAAd,EAAqB,CAArB,EAAwB,CAAxB,EAA2BM,KAA3B,EAAkCC,MAAlC;QAEAC,MAAM,CAACM,MAAP,CAAc,UAACC,IAAD,EAAU;UACtBX,OAAO,CAACW,IAAD,CAAP;QACD,CAFD,EAEGlB,IAAI,CAACmB,IAFR;MAGD,CAdD,MAcO;QACLZ,OAAO,CAACP,IAAD,CAAP;MACD;IACF,CApCc;EAAA,CAAf;;EAsCA,OAAO,IAAIoB,OAAJ,CAAY,UAACb,OAAD,EAAa;IAC9B,IAAMc,MAAM,GAAG,IAAIC,UAAJ,EAAf;IAEAD,MAAM,CAACE,aAAP,CAAqBvB,IAArB;;IAEAqB,MAAM,CAACG,MAAP,GAAgB,UAACC,CAAD,EAAO;MACrBtB,KAAK,CAACuB,GAAN,GAAYD,CAAC,CAACE,MAAF,CAASC,MAAT,CAAgBC,QAAhB,EAAZ;MAEA1B,KAAK,CAACqB,MAAN,GAAelB,MAAM,CAACC,OAAD,CAArB;IACD,CAJD;EAKD,CAVM,CAAP;AAWD;;AAED,SAASR,WAAT"},"metadata":{},"sourceType":"module"}